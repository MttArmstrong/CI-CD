<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>CI/CD: Matrix</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/intersect/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/intersect/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/intersect/favicon-16x16.png"><link rel="manifest" href="favicons/intersect/site.webmanifest"><link rel="mask-icon" href="favicons/intersect/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav intersect"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="intersect-logo" alt="CI/CD" src="assets/images/intersect-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/ci-for-python-package-matrix.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav intersect" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="CI/CD" src="assets/images/intersect-logo-sm.svg"></div>
    <div class="lesson-title-md">
      CI/CD
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            CI/CD
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  CI/CD
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 38%" class="percentage">
    38%
  </div>
  <div class="progress intersect">
    <div class="progress-bar intersect" role="progressbar" style="width: 38%" aria-valuenow="38" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/ci-for-python-package-matrix.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="exit-codes.html">2. Exit Codes</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="understanding-yaml.html">3. Understanding Yet Another Markup Language</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="yaml-and-github-actions.html">4. YAML and GitHub Actions</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="hello-ci-world.html">5. Hello CI World</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="ci-for-python-package-unit-test.html">6. CI for Python Package</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Matrix
        </span>
      
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="cd-for-python-package.html">8. CD for Python Package</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="add-badges.html">9. Badge for CI/CD</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="discuss-documentation-ci-cd.html">10. (Bonus) Discuss CI/CD for Documentation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="quick-primer-on-containers.html">11. (Bonus) Quick primer on Containers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="ci-cd-for-documentation-using-containers.html">12. (Bonus) Implementing CI/CD for documentation using containers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="ci-for-python-package-unit-test.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="cd-for-python-package.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="ci-for-python-package-unit-test.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: CI for Python
        </a>
        <a class="chapter-link float-end" href="cd-for-python-package.html" rel="next">
          Next: CD for Python...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Matrix</h1>
        <p>Last updated on 2025-06-18 |

        <a href="https://github.com/INTERSECT-training/CI-CD/edit/main/episodes/ci-for-python-package-matrix.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I run CI for multiple Python versions and /or different
platforms?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Don’t Repeat Yourself (DRY)</li>
<li>Use a single job for multiple jobs</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Let’s assume our tests are running great.</p>
<p>Yet, the domain scientist reports they are getting errors when they
run the Python package.</p>
<p>After talking with them, you find that they are running Python 3.11,
not 3.10.</p>
<p>How do we include this version of Python in our testing?</p>
<div class="section level1">
<h1 id="multiple-version-python-testing---naive-approach">Multiple version Python testing - Naive Approach<a class="anchor" aria-label="anchor" href="#multiple-version-python-testing---naive-approach"></a></h1>
<p>One approach would be to add another job to run tests for Python 3.11
as well.</p>
<p>Up to this point, we currently have the following:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Code Checks</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> push</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="at">  </span><span class="fu">greeting</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Greeting!</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> echo hello world</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="at">  </span><span class="fu">test-python-3-10</span><span class="kw">:</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Check Python 3.10 on Ubuntu</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.10"</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install package</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pip install -e .[test]</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test package</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pytest</span></span></code></pre>
</div>
<p>Let’s add testing a different version of Python in our CI!</p>
<div id="action-add-python-3.11-test" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="action-add-python-3.11-test" class="callout-inner">
<h3 class="callout-title">Action: Add Python 3.11 test</h3>
<div class="callout-content">
<p>First, remove the <code>greeting</code> job.</p>
<p>Then, add a new job called <code>test-python-3-11</code>.</p>
<p>Have this new job: - Checkout the code - Setup a Python 3.11
environment - Install the package with our test dependencies - Run the
tests via <code>pytest</code></p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Code Checks</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> push</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="at">  </span><span class="fu">test-python-3-10</span><span class="kw">:</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Check Python 3.10 on Ubuntu</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.10"</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install package</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pip install -e .[test]</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test package</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pytest</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="at">  </span><span class="fu">test-python-3-11</span><span class="kw">:</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Check Python 3.11 on Ubuntu</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.11"</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install package</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pip install -e .[test]</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test package</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pytest</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now, let’s add this so we can catch any Python 3.11 bugs going
forward!</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">git</span> add .github/workflows/main.yml</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Adds job to CI for Python 3.11"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">git</span> push</span></code></pre>
</div>
<p>Check the output!</p>
<figure><img src="%7B%7B%20page.root%20%7D%7D/fig/python-ci-matrix-naive-approach.png" alt="GitHub Actions multi-version" class="figure mx-auto d-block"><div class="figcaption">GitHub Actions multi-version</div>
</figure><p>Now, we do technically have multiple-versions of Python
supported.</p>
<p>Yet, we just added 13 lines of identical code with only one character
change…</p>
<div class="section level2">
<h2 id="dry-your-ci">DRY your CI<a class="anchor" aria-label="anchor" href="#dry-your-ci"></a></h2>
<p>“DRY” is an ancronym for [“Don’t Repeat Yourself”][dry], meaning
don’t have repeated code in your software. This reduces repetition and
avoids redundancy.</p>
<p>We do this for our software. There is no reason we should not apply
this principle to CI!</p>
</div>
</div>
<div class="section level1">
<h1 id="matrix">Matrix<a class="anchor" aria-label="anchor" href="#matrix"></a></h1>
<div id="action-building-a-matrix-across-different-versions" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="action-building-a-matrix-across-different-versions" class="callout-inner">
<h3 class="callout-title">Action: Building a matrix across different versions</h3>
<div class="callout-content">
<p>We could do better using <code>matrix</code>. The latter allows us to
test the code against a combination of versions in a single job. Let’s
update our <code>.github/workflow/main.yml</code> and use
<code>matrix</code>.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Code Checks</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> push</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="at">  </span><span class="fu">test-python-versions</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Check Python {% raw %}${{ matrix.python-version }}{% endraw %} on Ubuntu</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="at">        </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"3.10"</span><span class="kw">,</span><span class="at"> </span><span class="st">"3.11"</span><span class="kw">]</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Setup Python {% raw %}${{ matrix.python-version }}{% endraw %}</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">% raw %</span><span class="kw">}</span><span class="at">${{ matrix.python-version }}{% endraw %}</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install package</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pip install -e .[test]</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test package</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pytest</span></span></code></pre>
</div>
<p>YAML truncates trailing zeroes from a floating point number, which
means that <code>version: [3.9, 3.10, 3.11]</code> will automatically be
converted to <code>version: [3.9, 3.1, 3.11]</code> (notice
<code>3.1</code> instead of <code>3.10</code>). The conversion will lead
to unexpected failures as your CI will be running on a version not
specified by you. This behavior resulted in several failed jobs after
the release of Python 3.10 on GitHub Actions. The conversion (and the
build failure) can be avoided by converting the floating point number to
strings - <code>version: ['3.9', '3.10', '3.11']</code>.</p>
<p>More details on matrix: <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix" class="external-link">https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions</a>.</p>
</div>
</div>
</div>
<p>We can push the changes to GitHub and see how it will look like.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">git</span> add .github/workflows/main.yml</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Adds multi-version Python testing to CI via matrix"</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">git</span> push</span></code></pre>
</div>
<p>That is a much better way to add new versions and we have a
DRY-compliant CI!</p>
<div class="section level2">
<h2 id="test-experimental-versions-in-ci">Test experimental versions in CI<a class="anchor" aria-label="anchor" href="#test-experimental-versions-in-ci"></a></h2>
<p>Sometimes in your matrix, you want to push the boundaries of your
testing.</p>
<p>An example would be to test up to the latest alpha / beta release of
a Python version.</p>
<p>You do not want a failure in such cutting-edge, unstable tests
stopping your CI.</p>
<p>At time of writing, the latest supported beta version of Python for
the <code>actions/python-versions</code> is 3.12.0-beta.4 based on their
<a href="https://github.com/actions/python-versions/releases" class="external-link">GitHub
Releases</a>.</p>
<p>Let’s add this to our python version testing.</p>
<div class="section level3">
<h3 id="allow-experimental-jobs-to-fail-in-ci">Allow experimental jobs to fail in CI<a class="anchor" aria-label="anchor" href="#allow-experimental-jobs-to-fail-in-ci"></a></h3>
<p>This gets a little complicated, but there are a few flags we need to
set.</p>
<p>GitHub Actions will cancel all in-progress and queued jobs in the
matrix if any job in the matrix fails.</p>
<p>To disable this, we need to disable <code>fail-fast</code> in the
matrix strategy.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">  </span><span class="fu">fail-fast</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span></code></pre>
</div>
<p>That should do it, right? Nope…</p>
<p>We have to add <code>continue-on-error: true</code> to a single job
that we allow to fail. If enabled, jobs in the matrix continue to run if
there is an error. By default <code>continue-on-error: false</code> and
will also cancel the matrix jobs if the “experimental” job fails.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">continue-on-error</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre>
</div>
<p>More details: <a href="https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategyfail-fast" class="external-link">https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategyfail-fast</a></p>
<p>Finally, we need to add this experimental job to the matrix. Also, we
need to flag it as “allowed to fail” somehow.</p>
<p>For this, we use <code>include</code> to add a single extra job to
the matrix with “metadata”.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="at">  </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="at">    </span><span class="fu">include</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.12.0-beta.4"</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">        </span><span class="fu">allow_failure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre>
</div>
<p>This will add the string <code>"3.12.0-beta.4"</code> to the
<code>python-version</code> list in matrix with the arbitrary variable
<code>allow_failure</code> set to <code>true</code> as “metadata”. We
also must add the <code>allow_failure</code> “metadata” to the other
members of the matrix (see below).</p>
<p>More detail: <a href="https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategymatrixinclude" class="external-link">https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategymatrixinclude</a></p>
<div id="putting-it-together-for-python-experimental-job" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="putting-it-together-for-python-experimental-job" class="callout-inner">
<h3 class="callout-title">Putting it together for Python experimental job…</h3>
<div class="callout-content">
<p>So if we <strong>only</strong> want to allow the job with version set
to <code>3.12.0-beta.4</code> to fail without failing the workflow run,
we need something like:</p>
<p>Then the following would work for a job:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="at">   </span><span class="fu">job</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="at">     </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="at">     </span><span class="fu">continue-on-error</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">% raw %</span><span class="kw">}</span><span class="at">${{ matrix.allow_failure }}{% endraw %}</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="at">     </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="at">       </span><span class="fu">fail-fast</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="at"> </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="at">       </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="at">         </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"3.10"</span><span class="kw">,</span><span class="at"> </span><span class="st">"3.11"</span><span class="kw">]</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="at">         </span><span class="fu">allow_failure</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="ch">false</span><span class="kw">]</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="at">         </span><span class="fu">include</span><span class="kw">:</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="at">           </span><span class="kw">-</span><span class="at"> </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.12.0-beta.4"</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="at">             </span><span class="fu">allow_failure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>::::::::::::::::::::::::::::::::::::: challenge</p>
</div>
</div>
<div class="section level2">
<h2 id="action-add-experimental-job-that-is-allowed-to-fail-in-the-matrix">Action: Add experimental job that is allowed to fail in the
matrix<a class="anchor" aria-label="anchor" href="#action-add-experimental-job-that-is-allowed-to-fail-in-the-matrix"></a></h2>
<p>Add “3.12.0-beta.4” to our current Python package CI YAML via the
matrix but allow it to fail.</p>
<p>::::::::::::::::::::::::::::::::::::: solution</p>
<p>## Solution ```yaml name: Code Checks on: push jobs:</p>
<p>test-python-versions: name: Check Python {% raw %}<span class="math inline">\({{ matrix.python-version }}{% endraw %} on Ubuntu
     runs-on: ubuntu-latest
     continue-on-error: {% raw %}\)</span>{{ matrix.allow_failure }}{%
endraw %} strategy: fail-fast: false matrix: python-version: [“3.10”,
“3.11”] allow_failure: [false] include: - python-version:
“3.12.0-beta.4” allow_failure: true</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a> <span class="ex">steps:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>   <span class="ex">-</span> uses: actions/checkout@v3</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>   <span class="ex">-</span> name: Setup Python {% raw %}<span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}{% endraw %}</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>     <span class="ex">uses:</span> actions/setup-python@v4</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>     <span class="ex">with:</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>       <span class="ex">python-version:</span> {% raw %}<span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}{% endraw %}</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>   <span class="ex">-</span> name: Install package</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>     <span class="ex">run:</span> python <span class="at">-m</span> pip install <span class="at">-e</span> .<span class="pp">[</span><span class="ss">test</span><span class="pp">]</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>   <span class="ex">-</span> name: Test package</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>     <span class="ex">run:</span> python <span class="at">-m</span> pytest</span></code></pre>
</div>
<pre><code>
:::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::

Let's commit this and see how it looks!

```bash
git add .github/workflows/main.yml
git commit -m "Adds experimental Python 3.12.0-beta.4 test to CI"
git push -u origin add-ci</code></pre>
<p>We see that the overall workflow passed even though the Python
3.12.0-beta.4 job failed!</p>
<p>Also, note that we see that GitHub Actions reports an exit code that
is non-zero! Like previously discussed, exit codes are what CI tools /
solution are built around.</p>
<figure><img src="%7B%7B%20page.root%20%7D%7D/fig/python-ci-matrix-allow-failure.png" alt="GitHub Actions allow failure" class="figure mx-auto d-block"><div class="figcaption">GitHub Actions allow failure</div>
</figure><div id="experimental-ci-jobs" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="experimental-ci-jobs" class="callout-inner">
<h3 class="callout-title">Experimental CI jobs</h3>
<div class="callout-content">
<p>This allows us to run all kinds of “experimental” jobs. Examples are
trying new versions of software or checking deprecated versions.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="cross-platform-testing">Cross-platform testing<a class="anchor" aria-label="anchor" href="#cross-platform-testing"></a></h2>
<p>Uh oh… the domain scientist is back with an issue.</p>
<p>After talking with him, you find out his summer intern cannot run the
python package on their Windows machine.</p>
<p>You have Linux Ubuntu and your domain scientist collaborator / team
member has Mac.</p>
<p>How do we test our Python package across Linux, Mac, and Windows
(i.e. cross-platform)?</p>
<div class="section level3">
<h3 id="selecting-the-github-hosted-runner-platform">Selecting the GitHub-hosted runner platform<a class="anchor" aria-label="anchor" href="#selecting-the-github-hosted-runner-platform"></a></h3>
<p>We honestly already have what we need, the
[<code>runs-on</code>][runs-on] command!</p>
<p>All we need to know is what values are allowed.</p>
<p>Inside of the <code>runs-on</code> documentation, there is a list of
labels we can use to select the platform of the runner: [list of labels
for runner types][runner-types]</p>
<div id="action-find-out-the-labels-for-all-three-platforms" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="action-find-out-the-labels-for-all-three-platforms" class="callout-inner">
<h3 class="callout-title">Action: Find out the labels for all three platforms</h3>
<div class="callout-content">
<p>Using the documentation links above, get the three “latest” labels
for Linux, Mac, and Windows.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ul><li>Linux: <code>ubuntu-latest</code>
</li>
<li>Mac: <code>macos-latest</code>
</li>
<li>Windows: <code>windows-latest</code>
</li>
</ul></div>
</div>
</div>
</div>
<p>Using these labels, we could create the following setup to run on all
three platforms!</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">ubuntu-latest</span><span class="kw">,</span><span class="at"> macos-latest</span><span class="kw">,</span><span class="at"> windows-latest</span><span class="kw">]</span></span></code></pre>
</div>
<div id="not-necessarily-the-best-practice-to-use-latest" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="not-necessarily-the-best-practice-to-use-latest" class="callout-inner">
<h3 class="callout-title">Not necessarily the best practice to use “latest”…</h3>
<div class="callout-content">
<p>It is arguable but… using “latest” versions for the platforms may not
be the best practice. This practice is essentially testing versions of
the platforms that will change, eventually, when the newest OS platform
version is created for “latest”.</p>
<p>This leaves you vulnerable to your CI breaking due to no change to
the code.</p>
<p>However, this is a very infrequent change and probably fine to stay
with “latest” so you don’t have to change when the other eventual change
will occur: a pinned version of the OS platform is deprecated and no
longer available!</p>
</div>
</div>
</div>
<p>::::::::::::::::::::::::::::::::::::: challenge</p>
</div>
</div>
<div class="section level2">
<h2 id="action-add-cross-platform-testing-to-ci-yaml">Action: Add cross-platform testing to CI YAML<a class="anchor" aria-label="anchor" href="#action-add-cross-platform-testing-to-ci-yaml"></a></h2>
<p>Using the “latest” labels, add Linux, Mac, and Windows testing to our
current CI YAML.</p>
<p>HINT: You will need a variable under <code>matrix</code> that you use
for <code>runs-on</code> and also for the <code>include</code></p>
<p>::::::::::::::::::::::::::::::::::::: solution</p>
<p>## Solution ```yaml name: Code Checks on: push jobs:</p>
<p>test-python-versions: name: Check Python {% raw %}<span class="math inline">\({{ matrix.python-version }}{% endraw %} on {% raw
%}\)</span>{{ matrix.runs-on }}{% endraw %} continue-on-error: {% raw
%}<span class="math inline">\({{ matrix.allow_failure }}{% endraw %}
     runs-on: {% raw %}\)</span>{{ matrix.runs-on }}{% endraw %}
strategy: fail-fast: false matrix: runs-on: [ubuntu-latest,
windows-latest, macos-latest] python-version: [“3.10”, “3.11”]
allow_failure: [false] include: - python-version: “3.12.0-beta.4”
runs-on: ubuntu-latest allow_failure: true</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a> <span class="ex">steps:</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>   <span class="ex">-</span> uses: actions/checkout@v3</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>   <span class="ex">-</span> name: Setup Python {% raw %}<span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}{% endraw %}</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>     <span class="ex">uses:</span> actions/setup-python@v4</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>     <span class="ex">with:</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>       <span class="ex">python-version:</span> {% raw %}<span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}{% endraw %}</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>   <span class="ex">-</span> name: Install package</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>     <span class="ex">run:</span> python <span class="at">-m</span> pip install <span class="at">-e</span> .<span class="pp">[</span><span class="ss">test</span><span class="pp">]</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>   <span class="ex">-</span> name: Test package</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>     <span class="ex">run:</span> python <span class="at">-m</span> pytest</span></code></pre>
</div>
<pre><code>
:::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::

Let's push these changes and see how it goes!

```bash
git add .github/workflows/main.yml
git commit -m "Adds cross-platform testing to CI"
git push</code></pre>
<p>We see that now we are also testing across all the platforms!</p>
<figure><img src="%7B%7B%20page.root%20%7D%7D/fig/python-ci-matrix-cross-platform.png" alt="GitHub Actions cross platform" class="figure mx-auto d-block"><div class="figcaption">GitHub Actions cross platform</div>
</figure></div>
<div class="section level2">
<h2 id="pull-request">Pull Request<a class="anchor" aria-label="anchor" href="#pull-request"></a></h2>
<p>That wraps up the CI portion for the Python package.</p>
<p>If you’d like, you can add more steps to the jobs to perform other
checks (i.e. linting, format checks, documentation builds, etc.)</p>
<p>Once you are happy, let’s use our open pull request for this branch
and get it merged back into <code>main</code>!</p>
<p>You’ll notice that the Pull Request shows us that a CI check didn’t
pass but the overall workflow passed and able to be merged in!</p>
<figure><img src="%7B%7B%20page.root%20%7D%7D/fig/python-ci-matrix-cross-platform-pull-request.png" alt="GitHub Actions pull request" class="figure mx-auto d-block"><div class="figcaption">GitHub Actions pull request</div>
</figure></div>
<div class="section level2">
<h2 id="clean-up-local-repository">Clean up local repository<a class="anchor" aria-label="anchor" href="#clean-up-local-repository"></a></h2>
<p>To get your local repository up-to-date, you can run the
following:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">git</span> checkout main</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">git</span> pull</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">git</span> remote prune origin <span class="co"># prune any branches deleted in the remote / GitHub that are still local</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">git</span> branch <span class="at">-D</span> add-ci <span class="co"># optional</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Matrix can help DRY your CI for multi-version and cross-platform
testing</li>
<li>Using <code>matrix</code> allows to test the code against a
combination of versions.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="ci-for-python-package-unit-test.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="cd-for-python-package.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="ci-for-python-package-unit-test.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: CI for Python
        </a>
        <a class="chapter-link float-end" href="cd-for-python-package.html" rel="next">
          Next: CD for Python...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/INTERSECT-training/CI-CD/edit/main/episodes/ci-for-python-package-matrix.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/INTERSECT-training/CI-CD/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/INTERSECT-training/CI-CD/" class="external-link">Source</a></p>
				<p><a href="https://github.com/INTERSECT-training/CI-CD/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:icosden@princeton.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/intersect-training/varnish/tree/406bb97bab56e8a0c29f2f362164c5d4a05b7ee1" class="external-link">varnish (1.0.7.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://INTERSECT-training.github.io/CI-CD/ci-for-python-package-matrix.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Matrix",
  "creativeWorkStatus": "active",
  "url": "https://INTERSECT-training.github.io/CI-CD/ci-for-python-package-matrix.html",
  "identifier": "https://INTERSECT-training.github.io/CI-CD/ci-for-python-package-matrix.html",
  "dateCreated": "2025-06-18",
  "dateModified": "2025-06-18",
  "datePublished": "2025-07-01"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

